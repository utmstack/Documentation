## Installing Azure

### 1. Create "Event Hub" 
<Note>
    Using the official Azure documentation [Quickstart: Create an event hub using Azure portal](https://learn.microsoft.com/en-us/azure/event-hubs/event-hubs-create)
</Note>

### 2. Create a new "Shared access policy" to allow access to the Event Hub created, make sure you select the "Listen" permission.

<img
  height="200"
  src="/images/integrations/azure/evenhubaccesspolicy.png"
  alt="Azure"
/>

### 3. Get the Event Hub Shared Access policies - Connection string–primary key from "Shared access policy" created previously. It will be used to configure your tenant.

<img
  height="200"
  src="/images/integrations/azure/aacess_shared_policy.png"
  alt="Azure"
/>

> Sample Connection string–primary key:

<img
  height="200"
  src="/images/integrations/azure/examplekey.png"
  alt="Azure"
/>

### 4. Get the Consumer Group Name
> In: All services-> Event Hubs -> Your_Event_Hub_Namespace -> Event Hubs -> Your_Event_Hub_Instance -> Consumer groups. It will be used to configure your tenant.

<img
  height="200"
  src="/images/integrations/azure/consumer_group.png"
  alt="Azure"
/>

<Note>
    Create a new consumer group specifically for Logstash. Do not use the $default or any other consumer group that might already be in use. Reusing consumer groups among non-related consumers can cause unexpected behavior and possibly lost events. All Logstash instances should use the same consumer group so that they can work together for processing events.
</Note>

### 5. Create a "Storage Account"

<Note>
    Using the official Azure documentation [Quickstart: Create a storage account](https://learn.microsoft.com/en-us/azure/storage/common/storage-account-create?tabs=azure-portal)
</Note>

### 6. Get the "Storage Container Name" 
> In: All services -> Storage accounts -> Your_Storage_Account -> Containers. It will be used to configure your tenant.

<img
  height="200"
  src="/images/integrations/azure/container_name.png"
  alt="Azure"
/>

### 7. Get the Storage Account Connection string with key to access Azure "Storage Account". 

> Find the connection string here: All services -> Storage accounts -> Your_Storage_Account -> Access keys. It will be used to configure your tenant.

<img
  height="200"
  src="/images/integrations/azure/account_storage.png"
  alt="Azure"
/>

> Sample connection string:

<img
  height="200"
  src="/images/integrations/azure/samplestring.png"
  alt="Azure"
/>

### 8.Configure your Azure Subscription to send log to the Event Hub

> Go to Subscription and click on "Resource providers". Search for "Event Grid", and make sure is registered in the "Resources providers".

<img
  height="200"
  src="/images/integrations/azure/eventgrid.png"
  alt="Azure"
/>

### 9. Create a new Event by clicking in the Events -> Event Subscription

<img
  height="200"
  src="/images/integrations/azure/eventsubs.png"
  alt="Azure"
/>

### 10.Configure the "Event Subscription" to send logs to the Event Hub created previously.

<img
  height="200"
  src="/images/integrations/azure/eventhubselection.png"
  alt="Azure"
/>

### 11. Use the data collected in the previous steps to fill the form as documented below. You can add more than one Event Hub configuration by clicking on the Add tenant button.

<Note>
>
    * The input field Event Hub Shared access policies - Connection string refers to Azure's Event Hub Shared Access Policies - Connection string-primary key: Value obtained in step 3
    + Consumer Group Name: Value obtained in step 4
    * Storage Container Name: Value obtained in step 6
    * Storage Account Connection string with key: Value obtained in step 7
</Note>

<img
  height="200"
  src="/images/integrations/azure/step11.png"
  alt="Azure"
/>

### 12. Click on the button shown below, to activate the UTMStack features related to this integration